{% extends "base.html" %}

{% block content %}
    <h1 class="brand_title">{{ subject.name }}</h1>
    
    <div class="view_container">
        <div class="column_section">
            <h3 class="section_subtitle">tasks</h3>
            {% for task in subject.tasks %}
                <div class="task_item">
                    <span class="task_title">{{ task.title }}</span>
                    <div class="tags_container">
                        {% for t in task.tags %}
                            <span class="tag_badge">{{ t.name }}</span>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <p class="history_text">no tasks yet.</p>
            {% endfor %}
            <a href="{{ url_for('add_task') }}" class="secondary_link">+ new task</a>
        </div>

        <div class="column_section">
            <h3 class="section_subtitle">shared feed</h3>
            <div class="scroll_area feed_height">
                {% for msg in messages %}
                    <div class="message_box">
                        <strong class="accent_text">{{ msg.sender.username }}:</strong> 
                        {{ msg.content }}
                    </div>
                {% else %}
                    <p class="history_text">start the conversation...</p>
                {% endfor %}
            </div>

            <form action="{{ url_for('send_message', subject_id=subject.subject_id) }}" method="POST" class="bottom_margin_20">
                <input type="text" name="content" placeholder="send note to group..." class="input_field full_width" required>
            </form>

            <h3 class="section_subtitle">history</h3>
            <div class="scroll_area history_height">
                {% for s in subject.study_sessions|sort(attribute='start_time', reverse=True) %}
                    <div class="history_text_item">
                        {{ s.duration }}m — {{ s.start_time.strftime('%b %d, %I:%M %p') }}
                    </div>
                {% else %}
                    <p class="history_text">no sessions logged.</p>
                {% endfor %}
            </div>

            <form action="{{ url_for('log_session', subject_id=subject.subject_id) }}" method="POST" class="flex_row bottom_margin_25">
                <input type="number" name="duration" placeholder="mins" min="1" max="720" required class="short_input">
                <button type="submit" class="button_signup btn_small">log</button>
            </form>

            <h3 class="section_subtitle">invite collaborators</h3>
            <form action="{{ url_for('invite_user', subject_id=subject.subject_id) }}" method="POST" class="flex_row">
                <input type="text" name="username" placeholder="enter username" class="input_field no_margin flex_grow" required>
                <button type="submit" class="button_signup">invite</button>
            </form>
        </div>
    </div>

    <div class="footer_actions">
        <a href="{{ url_for('dashboard') }}" class="back_link">← back to menu</a>
        <a href="{{ url_for('delete_subject', subject_id=subject.subject_id) }}" 
           class="delete_link" 
           onclick="return confirm('Are you sure? This will delete all tasks and messages.')">
           delete subject
        </a>
    </div>
{% endblock %}